CREATE INDEX image_embedding_embedding_idx ON image_embedding USING ivfflat (embedding vector_cosine_ops) WITH (lists = 100);

UPDATE image_embeddings
SET embedding = '{' || regexp_replace(embedding, '(^|,)\.', '\10.', 'g') || '}';

UPDATE image_embeddings
SET embedding = '{' || embedding || '}';


SELECT id, embedding
FROM image_embeddings
WHERE embedding IS NULL
   OR embedding = ''
   OR embedding ~ '[^0-9\,\.\{\}\-]';

-- Удалить кавычки
UPDATE image_embeddings
SET embedding = TRIM(BOTH '"' FROM embedding);

-- Обернуть в фигурные скобки
UPDATE image_embeddings
SET embedding = '{' || embedding || '}';


ALTER TABLE image_embeddings
ALTER COLUMN embedding TYPE float8[]
USING embedding::float8[];

ALTER TABLE image_embeddings
ALTER COLUMN embedding TYPE vector(512)
USING embedding::vector(512);

SELECT id, array_ndims(embedding) as ndims
FROM image_embeddings
WHERE array_ndims(embedding) <> 1;

SELECT id, embedding
FROM image_embeddings
WHERE id IN (1,2);

UPDATE image_embeddings
SET embedding = (
    SELECT array_agg(e)
    FROM unnest(unnest(embedding)) AS e
);

SELECT data_type
FROM information_schema.columns
WHERE table_name = 'image_embeddings' AND column_name = 'embedding';

ARRAY

SELECT id, array_ndims(embedding) AS ndims, array_dims(embedding) AS dims
FROM image_embeddings
LIMIT 5;

1	2	"[1:1][1:512]"
392293	2	"[1:1][1:512]"
392294	2	"[1:1][1:512]"
392295	2	"[1:1][1:512]"
392296	2	"[1:1][1:512]"


UPDATE image_embeddings
SET embedding = array_cat(ARRAY[]::float8[], embedding);

UPDATE image_embeddings
SET embedding = embedding[1:1][1:512];

ALTER TABLE image_embeddings
ALTER COLUMN embedding TYPE vector(512)
USING embedding::vector(512);

UPDATE image_embeddings
SET embedding = (
    SELECT array_agg(embedding[1][i])
    FROM generate_series(1, 512) AS i
);


UPDATE image_embeddings
SET embedding = (
    SELECT array_agg(e)
    FROM unnest(embedding) AS e
);



UPDATE image_embeddings
SET embedding = array_cat(ARRAY[]::float8[], embedding)
WHERE array_ndims(embedding) <> 1;


CREATE INDEX idx_image_embeddings_embedding
ON image_embeddings
USING ivfflat (embedding vector_cosine_ops)
WITH (lists = 100);

ALTER TABLE image_embeddings
ALTER COLUMN embedding TYPE vector(512)
USING substring(embedding from 2 for char_length(embedding) - 2)::float8[];


ERROR:  Array value must start with "{" or dimension information.malformed array literal: "0.10774155706167221,-0.0583755187690258,-0.06729332357645035,-0.049772679805755615,0.007229245733469725,0.055190201848745346,0.04978034272789955,-0.02900664322078228,0.04220936819911003,-0.09416074305772781,-0.05967371538281441,-0.02271367982029915,0.03371521458029747,-0.005986055824905634,0.00706598861142993,-0.021605396643280983,-0.0038808174431324005,-0.057722918689250946,0.010080560110509396,-0.05009528622031212,-0.05125824362039566,-0.06481612473726273,0.07172772288322449,0.005919213872402906,0.012481541372835636,0.04291876032948494,-0.037758033722639084,-0.09963174909353256,-0.005612322129309177,-0.041589777916669846,0.0219738706946373,0.06946969777345657,-0.07510991394519806,0.02721560187637806,-0.02594069577753544,0.03699960932135582,0.031111156567931175,0.0073699853383004665,-0.12341159582138062,-0.004125907085835934,0.015685010701417923,-0.007401455659419298,-0.08326605707406998,0.007510272786021233,0.04051625356078148,-0.06350748986005783,0.02185886725783348,0.07450475543737411,-0.10334805399179459,-0.06496347486972809,-0.0068376874551177025,-0.008403122425079346,0.0010076543549075723,0.05178007110953331,-0.07657935470342636,0.07638948410749435,0.01806575246155262,-0.007876457646489143,0.06579127162694931,0.0532081238925457,0.016068173572421074,0.026376644149422646,-0.008070598356425762,0.008080589585006237,0.01506655104458332,0.03251944109797478,0.025768423452973366,0.00820520706474781,-0.013079549185931683,-0.01929093524813652,-0.07309155911207199,-0.021165866404771805,0.038362205028533936,0.03613416105508804,0.031706374138593674,-0.07179524749517441,-0.05697158724069595,-0.012647108174860477,-0.030475780367851257,0.026643257588148117,0.03316756337881088,0.026106907054781914,-0.03584670647978783,0.05972159281373024,-0.009920521639287472,-0.013868803158402443,-0.03948323801159859,0.0065338704735040665,-0.012022849172353745,0.013129211962223053,0.10393476486206055,0.041364505887031555,0.08399836719036102,-0.04340553283691406,0.04574208706617355,-8.269522368209437e-05,-0.03291202709078789,0.02522946521639824,-0.0662614181637764,-0.04746972769498825,0.06980381906032562,-0.055910468101501465,-0.03875293582677841,0.01869591884315014,0.0009592088172212243,0.03673059493303299,-0.006753075867891312,-0.03185632824897766,-0.09274857491254807,-0.04472716897726059,0.0518062599003315,0.042164042592048645,-0.03396397456526756,-0.03021048940718174,0.022295493632555008,-0.040666718035936356,0.006693705916404724,-0.10106094926595688,-0.008093457669019699,0.04980356618762016,-0.043690819293260574,0.03413616120815277,0.04152284935116768,-0.044580794870853424,-0.052835773676633835,-0.05440346524119377,0.011000216007232666,-0.0704236626625061,0.027270372956991196,-0.013104665093123913,-0.045892421156167984,0.03357192501425743,-0.009317835792899132,-0.016461601480841637,-0.09548021107912064,-0.002274594269692898,0.010512526147067547,-0.07013269513845444,0.03400886431336403,0.022322120144963264,-0.026013551279902458,-0.010260566137731075,-0.02881157025694847,0.030395034700632095,0.06821960210800171,-0.11747393757104874,0.0027913935482501984,0.006306952331215143,0.00015189274563454092,-0.025922441855072975,0.02042057178914547,-0.008792147040367126,-0.031314633786678314,0.0019570342265069485,0.01671520248055458,0.011107111349701881,-0.03570089489221573,0.04045943543314934,0.06876536458730698,-0.05773839354515076,0.08976482599973679,0.008632452227175236,0.0008644558256492019,-0.0919475257396698,0.02704264409840107,0.02125002257525921,-0.04783407598733902,0.028084345161914825,0.005088523495942354,0.021859996020793915,0.011913592927157879,0.007387845311313868,0.019421475008130074,-0.041864290833473206,0.09959101676940918,0.024649912491440773,-0.01989481784403324,0.008289052173495293,-0.02983819879591465,-0.004011384677141905,-0.017568504437804222,0.07416120916604996,-0.11574999243021011,-0.06176217645406723,0.010971627198159695,0.04295186325907707,0.009721334092319012,0.020964784547686577,0.03170901909470558,0.012726773507893085,0.0018028935883194208,-0.1161682978272438,0.04603641480207443,-0.05162518471479416,-0.020348994061350822,-0.03757626563310623,0.05239000916481018,0.0690385177731514,-0.021062014624476433,-0.007403816096484661,0.05418795719742775,-0.01169027853757143,0.010971748270094395,0.03968289494514465,0.02334790863096714,0.0017236514249816537,0.054978322237730026,-0.03440302610397339,0.10596530884504318,0.10518237203359604,-0.03205670043826103,-0.012812178581953049,-0.055206090211868286,0.02779136225581169,0.020303649827837944,0.030513636767864227,-0.026241375133395195,0.0039888103492558,0.002942819381132722,0.015735747292637825,-0.07835676521062851,-0.1029457226395607,-0.06892674416303635,-0.04219243675470352,-0.03094315715134144,0.0030206500086933374,-0.00430357875302434,0.037064146250486374,-0.0837678611278534,-0.027922475710511208,0.021164190024137497,0.01261365320533514,-0.030868422240018845,-0.0615936703979969,0.03643885999917984,-0.02221715822815895,-0.03185686469078064,-0.020124657079577446,0.020938869565725327,-0.09358733892440796,0.07024890929460526,-0.02032320201396942,0.007087716367095709,-0.040829338133335114,0.013109873048961163,0.02035251446068287,0.053827863186597824,-0.003625230398029089,-0.09071105718612671,0.06366588175296783,0.05491871386766434,0.022108865901827812,0.0202530175447464,-0.012251289561390877,0.0014590234495699406,-0.03971143811941147,-0.039581093937158585,0.007358588743954897,0.026897383853793144,0.06109578162431717,0.010015249252319336,-0.009731641039252281,0.008478338830173016,-0.05102849006652832,0.01050895731896162,0.012173631228506565,0.033589400351047516,0.029516451060771942,-0.051365144550800323,-0.05636333301663399,-0.005816507153213024,-6.0373185988282785e-05,-0.009640190750360489,-0.006670033559203148,-0.0001179560786113143,-0.0372152253985405,0.03296547755599022,0.027521206066012383,-0.005155283957719803,-0.026375049725174904,-0.02085132524371147,0.05849408358335495,0.008622962050139904,-0.033888157457113266,-0.07247067987918854,-0.043226614594459534,-0.06102946028113365,-0.002535453997552395,0.018477363511919975,-0.002110167406499386,0.002929745940491557,0.002082715043798089,-0.00789877399802208,0.008837899193167686,0.028264379128813744,0.014813547022640705,0.029758263379335403,0.015154814347624779,-0.036346130073070526,-0.024157632142305374,0.020362423732876778,-0.018349532037973404,0.02353881485760212,0.01130414567887783,-0.001976948929950595,0.01834489032626152,-0.052165672183036804,-0.04433635622262955,0.10164516419172287,0.05614441633224487,-0.0809318795800209,-0.019805580377578735,0.045780159533023834,0.05471363663673401,-0.02422834374010563,-0.019533328711986542,-0.06933488696813583,0.056081973016262054,0.010657308623194695,0.019106969237327576,0.004561785142868757,-0.04782557487487793,-0.008463132195174694,0.024304213002324104,-0.030767828226089478,-0.012242523953318596,-0.010993105359375477,0.029899444431066513,-0.07465376704931259,0.010401248000562191,0.031840674579143524,0.0156112564727664,0.017583683133125305,0.011756188236176968,-0.029966408386826515,-0.08824051171541214,0.03634614497423172,-0.016572806984186172,0.12788261473178864,0.0028811870142817497,0.012319733388721943,-0.0654357299208641,0.014787359163165092,-0.08827999234199524,-0.010133117437362671,-0.08540444076061249,0.03263863921165466,0.00849701464176178,-0.03409816324710846,0.014740572310984135,0.008114994503557682,0.01784040592610836,0.027401966974139214,-0.07945498824119568,-0.06443536281585693,0.04231919348239899,0.07233501970767975,-0.061629656702280045,0.019465820863842964,0.018023742362856865,-0.034068528562784195,-0.052056655287742615,0.01232142187654972,-0.015913769602775574,-0.056229881942272186,0.06838804483413696,0.0566818006336689,-0.047262366861104965,0.0674310177564621,-0.0426197350025177,-0.022040123119950294,0.016413234174251556,-0.03961394727230072,0.03961727395653725,0.010815536603331566,0.06501370668411255,0.04554378241300583,-0.0073608518578112125,0.04391605779528618,0.028594380244612694,-0.0608915239572525,-0.08489610999822617,-0.033312272280454636,0.028625212609767914,-0.030021026730537415,0.007615852169692516,-0.01274836529046297,0.042418818920850754,0.01203282829374075,-0.058636512607336044,0.03675892949104309,0.011581195518374443,0.02003576047718525,0.06104380264878273,-0.02095898799598217,0.026887282729148865,0.05204419419169426,0.07113155722618103,0.010523722507059574,-0.0771806463599205,-0.06057322770357132,0.04089093953371048,-0.017570581287145615,0.011399980634450912,-0.024822557345032692,-0.019368911162018776,-0.04818959906697273,-0.07835421711206436,0.002943148370832205,0.04676736518740654,0.10722839087247849,0.04640795662999153,-0.024183304980397224,-0.06921152025461197,0.00815664790570736,-0.04262571036815643,0.01696111261844635,-0.038010552525520325,0.006833567284047604,-0.05865885317325592,-0.09901512414216995,0.05745721608400345,-0.042409397661685944,0.03928452730178833,-0.0036870529875159264,0.04647575318813324,-0.0065902299247682095,0.02122398652136326,-0.003185334848240018,-0.04503567889332771,0.010874668136239052,0.021886540576815605,-0.03668193146586418,-0.0554484985768795,-0.038591496646404266,0.023212911561131477,0.05524236708879471,0.07112463563680649,0.025280287489295006,-0.0029307929798960686,-0.04607655480504036,-0.01425655372440815,0.008182348683476448,0.024759426712989807,0.027885114774107933,0.02349335327744484,-0.0652148649096489,0.0015253365272656083,0.015245359390974045,-0.011265985667705536,-0.028826044872403145,-0.013725506141781807,-0.05761798098683357,-0.07059798389673233,-0.02960539050400257,0.0027197040617465973,-0.020207231864333153,0.0613555833697319,0.10573892295360565,0.001828123233281076,-0.017023785039782524,0.02527753822505474,-0.022128144279122353,0.0021460482385009527,-0.027544189244508743,-0.08169014006853104,-0.053961727768182755,0.014690332114696503,0.03389020264148712,0.049309082329273224,0.04102100804448128,-0.018117601051926613,-0.01844380795955658,0.017041467130184174,-0.018654396757483482,-0.04039771482348442,0.05540158599615097,-0.00612466037273407,0.02281288243830204,-0.015061288140714169,0.02322114072740078,0.011590300127863884,0.03955276682972908,0.024005962535738945,-0.012533816508948803,-0.002470374805852771,-0.08652356266975403,0.00954811554402113,0.041261933743953705,-0.06093136966228485,-0.04615624621510506,-0.0724494606256485,0.024636784568428993,-0.03472238406538963,0.05059513449668884,0.022901814430952072,-0.09770266711711884,-0.027938058599829674,0.07594599574804306,0.0011306124506518245,-0.04136737063527107,-0.06559529155492783,-0.06545919179916382,0.007906890474259853,-0.011792098172008991,0.01833052933216095,0.04688868671655655,-0.017091138288378716,-0.005003353115171194,-0.0320870615541935,0.015785954892635345,-0.05727926641702652"

ERROR:  malformed array literal: "0.10774155706167221,-0.0583755187690258,-0.06729332357645035,-0.049772679805755615,0.007229245733469725,0.055190201848745346,0.04978034272789955,-0.02900664322078228,0.04220936819911003,-0.09416074305772781,-0.05967371538281441,-0.02271367982029915,0.03371521458029747,-0.005986055824905634,0.00706598861142993,-0.021605396643280983,-0.0038808174431324005,-0.057722918689250946,0.010080560110509396,-0.05009528622031212,-0.05125824362039566,-0.06481612473726273,0.07172772288322449,0.005919213872402906,0.012481541372835636,0.04291876032948494,-0.037758033722639084,-0.09963174909353256,-0.005612322129309177,-0.041589777916669846,0.0219738706946373,0.06946969777345657,-0.07510991394519806,0.02721560187637806,-0.02594069577753544,0.03699960932135582,0.031111156567931175,0.0073699853383004665,-0.12341159582138062,-0.004125907085835934,0.015685010701417923,-0.007401455659419298,-0.08326605707406998,0.007510272786021233,0.04051625356078148,-0.06350748986005783,0.02185886725783348,0.07450475543737411,-0.10334805399179459,-0.06496347486972809,-0.0068376874551177025,-0.008403122425079346,0.0010076543549075723,0.05178007110953331,-0.07657935470342636,0.07638948410749435,0.01806575246155262,-0.007876457646489143,0.06579127162694931,0.0532081238925457,0.016068173572421074,0.026376644149422646,-0.008070598356425762,0.008080589585006237,0.01506655104458332,0.03251944109797478,0.025768423452973366,0.00820520706474781,-0.013079549185931683,-0.01929093524813652,-0.07309155911207199,-0.021165866404771805,0.038362205028533936,0.03613416105508804,0.031706374138593674,-0.07179524749517441,-0.05697158724069595,-0.012647108174860477,-0.030475780367851257,0.026643257588148117,0.03316756337881088,0.026106907054781914,-0.03584670647978783,0.05972159281373024,-0.009920521639287472,-0.013868803158402443,-0.03948323801159859,0.0065338704735040665,-0.012022849172353745,0.013129211962223053,0.10393476486206055,0.041364505887031555,0.08399836719036102,-0.04340553283691406,0.04574208706617355,-8.269522368209437e-05,-0.03291202709078789,0.02522946521639824,-0.0662614181637764,-0.04746972769498825,0.06980381906032562,-0.055910468101501465,-0.03875293582677841,0.01869591884315014,0.0009592088172212243,0.03673059493303299,-0.006753075867891312,-0.03185632824897766,-0.09274857491254807,-0.04472716897726059,0.0518062599003315,0.042164042592048645,-0.03396397456526756,-0.03021048940718174,0.022295493632555008,-0.040666718035936356,0.006693705916404724,-0.10106094926595688,-0.008093457669019699,0.04980356618762016,-0.043690819293260574,0.03413616120815277,0.04152284935116768,-0.044580794870853424,-0.052835773676633835,-0.05440346524119377,0.011000216007232666,-0.0704236626625061,0.027270372956991196,-0.013104665093123913,-0.045892421156167984,0.03357192501425743,-0.009317835792899132,-0.016461601480841637,-0.09548021107912064,-0.002274594269692898,0.010512526147067547,-0.07013269513845444,0.03400886431336403,0.022322120144963264,-0.026013551279902458,-0.010260566137731075,-0.02881157025694847,0.030395034700632095,0.06821960210800171,-0.11747393757104874,0.0027913935482501984,0.006306952331215143,0.00015189274563454092,-0.025922441855072975,0.02042057178914547,-0.008792147040367126,-0.031314633786678314,0.0019570342265069485,0.01671520248055458,0.011107111349701881,-0.03570089489221573,0.04045943543314934,0.06876536458730698,-0.05773839354515076,0.08976482599973679,0.008632452227175236,0.0008644558256492019,-0.0919475257396698,0.02704264409840107,0.02125002257525921,-0.04783407598733902,0.028084345161914825,0.005088523495942354,0.021859996020793915,0.011913592927157879,0.007387845311313868,0.019421475008130074,-0.041864290833473206,0.09959101676940918,0.024649912491440773,-0.01989481784403324,0.008289052173495293,-0.02983819879591465,-0.004011384677141905,-0.017568504437804222,0.07416120916604996,-0.11574999243021011,-0.06176217645406723,0.010971627198159695,0.04295186325907707,0.009721334092319012,0.020964784547686577,0.03170901909470558,0.012726773507893085,0.0018028935883194208,-0.1161682978272438,0.04603641480207443,-0.05162518471479416,-0.020348994061350822,-0.03757626563310623,0.05239000916481018,0.0690385177731514,-0.021062014624476433,-0.007403816096484661,0.05418795719742775,-0.01169027853757143,0.010971748270094395,0.03968289494514465,0.02334790863096714,0.0017236514249816537,0.054978322237730026,-0.03440302610397339,0.10596530884504318,0.10518237203359604,-0.03205670043826103,-0.012812178581953049,-0.055206090211868286,0.02779136225581169,0.020303649827837944,0.030513636767864227,-0.026241375133395195,0.0039888103492558,0.002942819381132722,0.015735747292637825,-0.07835676521062851,-0.1029457226395607,-0.06892674416303635,-0.04219243675470352,-0.03094315715134144,0.0030206500086933374,-0.00430357875302434,0.037064146250486374,-0.0837678611278534,-0.027922475710511208,0.021164190024137497,0.01261365320533514,-0.030868422240018845,-0.0615936703979969,0.03643885999917984,-0.02221715822815895,-0.03185686469078064,-0.020124657079577446,0.020938869565725327,-0.09358733892440796,0.07024890929460526,-0.02032320201396942,0.007087716367095709,-0.040829338133335114,0.013109873048961163,0.02035251446068287,0.053827863186597824,-0.003625230398029089,-0.09071105718612671,0.06366588175296783,0.05491871386766434,0.022108865901827812,0.0202530175447464,-0.012251289561390877,0.0014590234495699406,-0.03971143811941147,-0.039581093937158585,0.007358588743954897,0.026897383853793144,0.06109578162431717,0.010015249252319336,-0.009731641039252281,0.008478338830173016,-0.05102849006652832,0.01050895731896162,0.012173631228506565,0.033589400351047516,0.029516451060771942,-0.051365144550800323,-0.05636333301663399,-0.005816507153213024,-6.0373185988282785e-05,-0.009640190750360489,-0.006670033559203148,-0.0001179560786113143,-0.0372152253985405,0.03296547755599022,0.027521206066012383,-0.005155283957719803,-0.026375049725174904,-0.02085132524371147,0.05849408358335495,0.008622962050139904,-0.033888157457113266,-0.07247067987918854,-0.043226614594459534,-0.06102946028113365,-0.002535453997552395,0.018477363511919975,-0.002110167406499386,0.002929745940491557,0.002082715043798089,-0.00789877399802208,0.008837899193167686,0.028264379128813744,0.014813547022640705,0.029758263379335403,0.015154814347624779,-0.036346130073070526,-0.024157632142305374,0.020362423732876778,-0.018349532037973404,0.02353881485760212,0.01130414567887783,-0.001976948929950595,0.01834489032626152,-0.052165672183036804,-0.04433635622262955,0.10164516419172287,0.05614441633224487,-0.0809318795800209,-0.019805580377578735,0.045780159533023834,0.05471363663673401,-0.02422834374010563,-0.019533328711986542,-0.06933488696813583,0.056081973016262054,0.010657308623194695,0.019106969237327576,0.004561785142868757,-0.04782557487487793,-0.008463132195174694,0.024304213002324104,-0.030767828226089478,-0.012242523953318596,-0.010993105359375477,0.029899444431066513,-0.07465376704931259,0.010401248000562191,0.031840674579143524,0.0156112564727664,0.017583683133125305,0.011756188236176968,-0.029966408386826515,-0.08824051171541214,0.03634614497423172,-0.016572806984186172,0.12788261473178864,0.0028811870142817497,0.012319733388721943,-0.0654357299208641,0.014787359163165092,-0.08827999234199524,-0.010133117437362671,-0.08540444076061249,0.03263863921165466,0.00849701464176178,-0.03409816324710846,0.014740572310984135,0.008114994503557682,0.01784040592610836,0.027401966974139214,-0.07945498824119568,-0.06443536281585693,0.04231919348239899,0.07233501970767975,-0.061629656702280045,0.019465820863842964,0.018023742362856865,-0.034068528562784195,-0.052056655287742615,0.01232142187654972,-0.015913769602775574,-0.056229881942272186,0.06838804483413696,0.0566818006336689,-0.047262366861104965,0.0674310177564621,-0.0426197350025177,-0.022040123119950294,0.016413234174251556,-0.03961394727230072,0.03961727395653725,0.010815536603331566,0.06501370668411255,0.04554378241300583,-0.0073608518578112125,0.04391605779528618,0.028594380244612694,-0.0608915239572525,-0.08489610999822617,-0.033312272280454636,0.028625212609767914,-0.030021026730537415,0.007615852169692516,-0.01274836529046297,0.042418818920850754,0.01203282829374075,-0.058636512607336044,0.03675892949104309,0.011581195518374443,0.02003576047718525,0.06104380264878273,-0.02095898799598217,0.026887282729148865,0.05204419419169426,0.07113155722618103,0.010523722507059574,-0.0771806463599205,-0.06057322770357132,0.04089093953371048,-0.017570581287145615,0.011399980634450912,-0.024822557345032692,-0.019368911162018776,-0.04818959906697273,-0.07835421711206436,0.002943148370832205,0.04676736518740654,0.10722839087247849,0.04640795662999153,-0.024183304980397224,-0.06921152025461197,0.00815664790570736,-0.04262571036815643,0.01696111261844635,-0.038010552525520325,0.006833567284047604,-0.05865885317325592,-0.09901512414216995,0.05745721608400345,-0.042409397661685944,0.03928452730178833,-0.0036870529875159264,0.04647575318813324,-0.0065902299247682095,0.02122398652136326,-0.003185334848240018,-0.04503567889332771,0.010874668136239052,0.021886540576815605,-0.03668193146586418,-0.0554484985768795,-0.038591496646404266,0.023212911561131477,0.05524236708879471,0.07112463563680649,0.025280287489295006,-0.0029307929798960686,-0.04607655480504036,-0.01425655372440815,0.008182348683476448,0.024759426712989807,0.027885114774107933,0.02349335327744484,-0.0652148649096489,0.0015253365272656083,0.015245359390974045,-0.011265985667705536,-0.028826044872403145,-0.013725506141781807,-0.05761798098683357,-0.07059798389673233,-0.02960539050400257,0.0027197040617465973,-0.020207231864333153,0.0613555833697319,0.10573892295360565,0.001828123233281076,-0.017023785039782524,0.02527753822505474,-0.022128144279122353,0.0021460482385009527,-0.027544189244508743,-0.08169014006853104,-0.053961727768182755,0.014690332114696503,0.03389020264148712,0.049309082329273224,0.04102100804448128,-0.018117601051926613,-0.01844380795955658,0.017041467130184174,-0.018654396757483482,-0.04039771482348442,0.05540158599615097,-0.00612466037273407,0.02281288243830204,-0.015061288140714169,0.02322114072740078,0.011590300127863884,0.03955276682972908,0.024005962535738945,-0.012533816508948803,-0.002470374805852771,-0.08652356266975403,0.00954811554402113,0.041261933743953705,-0.06093136966228485,-0.04615624621510506,-0.0724494606256485,0.024636784568428993,-0.03472238406538963,0.05059513449668884,0.022901814430952072,-0.09770266711711884,-0.027938058599829674,0.07594599574804306,0.0011306124506518245,-0.04136737063527107,-0.06559529155492783,-0.06545919179916382,0.007906890474259853,-0.011792098172008991,0.01833052933216095,0.04688868671655655,-0.017091138288378716,-0.005003353115171194,-0.0320870615541935,0.015785954892635345,-0.05727926641702652"
SQL state: 22P02
Detail: Array value must start with "{" or dimension information.

CREATE INDEX image_embeddings_embedding_idx ON image_embeddings USING ivfflat (embedding vector_cosine_ops) WITH (lists = 100);

ERROR:  operator class "vector_cosine_ops" does not accept data type character varying

SQL state: 42804